package dev._3000IQPlay.trillium.modules.exploit;

import com.mojang.realmsclient.gui.ChatFormatting;
import dev._3000IQPlay.trillium.setting.Setting;
import dev._3000IQPlay.trillium.modules.Module;
import dev._3000IQPlay.trillium.command.Command;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.GuiGameOver;
import net.minecraft.client.gui.inventory.GuiInventory;
import net.minecraft.init.Items;
import net.minecraft.inventory.ClickType;
import net.minecraft.item.ItemStack;
import net.minecraft.network.play.client.CPacketCloseWindow;

import java.awt.*;
import java.util.Objects;

public class AutoCraftDupe
        extends Module {
	private final Setting<Integer> x  = this.register(new Setting<Integer>("MouseClickX", 784, 0, 1120));
    private final Setting<Integer> y  = this.register(new Setting<Integer>("MouseClickY", 448, 0, 640));
    private int i = 0;
    private int r = 0;
    private int p = 0;
    private int prevAmount;
	private int currentSlot;
    Robot robot;
	
	public AutoCraftDupe() {
        super("AutoCraftDupe", "Best on 8b8t.xyz, 5b5t.org a 6b6t.org", Module.Category.EXPLOIT, true, false ,false);
    }

    @Override
    public void onDisable() {
        this.i = 0;
        this.r = 0;
        this.p = 0;
    }

    @Override
    public void onEnable() {
		currentSlot = mc.player.inventory.currentItem;
        try {
            this.robot = new Robot();
        } catch (AWTException e) {
            e.printStackTrace();
        }
        this.i = 0;
        this.r = 0;
        this.p = 0;
    }

    @Override
    public void onUpdate() {
        if (mc.player == null) {
            return;
        }
        if (mc.currentScreen instanceof GuiGameOver) {
            return;
        }
        ItemStack slot = mc.player.inventory.getStackInSlot(currentSlot);
        ++this.i;
        if (this.i == 3) {
            if (slot.getItem() == Items.AIR) {
                Command.sendMessage(ChatFormatting.RED + "[AutoCraftDupe] " + ChatFormatting.RESET + "No your current slot!");
                this.i = 0;
                return;
            }
            mc.player.rotationPitch = 90.0f;
            this.prevAmount = slot.getCount();
        }
        if (this.i > 15 && this.i < 18) {
            mc.playerController.windowClick(0, currentSlot + 36, 1, ClickType.THROW, mc.player);
        }
        if (this.i == 30) {
            mc.player.rotationPitch = 0.0f;
            mc.displayGuiScreen(new GuiInventory(mc.player));
        }
        if (this.i >= 40 && this.i < 100) {
            this.robot.mouseMove(this.x.getValue(), this.y.getValue());
            this.robot.mousePress(1024);
            this.robot.mouseRelease(1024);
        }
        if (this.i == 100) {
            Objects.requireNonNull(mc.getConnection()).sendPacket(new CPacketCloseWindow());
        }
        if (this.i >= 101) {
            mc.player.inventory.currentItem = currentSlot;
            if (slot.getCount() > 1) {
                mc.displayGuiScreen(null);
            }
            if (this.i % 2 == 0) {
                ++this.r;
                if (this.r % 2 == 0) {
                    ++this.p;
                    if (this.p % 2 == 0) {
                        if (slot.getCount() > 2) {
                            mc.player.dropItem(false);
                        }
                        if (slot.getCount() == 2) {
                            this.r = 0;
                            this.i = 0;
                            this.p = 0;
                        }
                        if (slot.getCount() == 0) {
                            Command.sendMessage(ChatFormatting.RED + "[AutoCraftDupe] " + ChatFormatting.RESET + "Could not check if dupe has been successful!");
                        }
                        if (this.p == 160) {
                            Command.sendMessage(ChatFormatting.RED + "[AutoCraftDupe] " + ChatFormatting.RESET + "Disabling AutoCraftDupe, Something has failed!");
							this.disable();
                            this.r = 0;
                            this.i = 0;
                            this.p = 0;
                        }
                    }
                }
            }
        }
    }
}