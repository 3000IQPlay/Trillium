package dev._3000IQPlay.trillium.modules.exploit;

import dev._3000IQPlay.trillium.event.events.PacketEvent;
import dev._3000IQPlay.trillium.modules.Module;
import dev._3000IQPlay.trillium.setting.Setting;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.network.play.client.CPacketEntityAction;
import net.minecraft.network.play.client.CPacketPlayer;
import net.minecraft.network.play.client.CPacketPlayerDigging;
import net.minecraft.network.play.client.CPacketPlayerDigging.Action;
import net.minecraft.network.play.client.CPacketPlayerTryUseItem;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;

import java.util.Arrays;

public class FarThrow
        extends Module {
	public Setting<Integer> spoof = this.register(new Setting<Integer>("Spoof", 65, 0, 500));
	public Setting<Boolean> arrows = this.register(new Setting<Boolean>("Arrows", true));
	public Setting<EP> enderPearls = this.register(new Setting<EP>("EnderPearls", EP.False));
	public Setting<Boolean> potions = this.register(new Setting<Boolean>("Potions", true));
	public Setting<Boolean> eggsAndSnowballs = this.register(new Setting<Boolean>("Snowballs", true));
	
	public FarThrow() {
        super("FarThrow", "Makes you throw the things farther then ever before", Module.Category.EXPLOIT, true, false, false);
    }

	
	@SubscribeEvent
	public void onPacketSend(PacketEvent.Send e) {
		if (e.getPacket() instanceof CPacketPlayerDigging && this.arrows.getValue() && FarThrow.mc.player.getHeldItemMainhand().getItem() == Items.BOW) {
			CPacketPlayerDigging packet = e.getPacket();
			if (packet.getAction() == Action.RELEASE_USE_ITEM) {
				FarThrow.mc.getConnection().sendPacket(new CPacketEntityAction(FarThrow.mc.player, CPacketEntityAction.Action.START_SPRINTING));
				for (int i = 0; i < this.spoof.getValue(); i++) {
					FarThrow.mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(FarThrow.mc.player.posX, FarThrow.mc.player.posY + 1e-10, FarThrow.mc.player.posZ, FarThrow.mc.player.rotationYaw, FarThrow.mc.player.rotationPitch, false));
					FarThrow.mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(FarThrow.mc.player.posX, FarThrow.mc.player.posY, FarThrow.mc.player.posZ, FarThrow.mc.player.rotationYaw, FarThrow.mc.player.rotationPitch, true));
				}
			}
		}
		if (e.getPacket() instanceof CPacketPlayerTryUseItem) {
			CPacketPlayerTryUseItem packet = e.getPacket();
			Item item = FarThrow.mc.player.getHeldItem(packet.getHand()).getItem();
			boolean eps = (this.enderPearls.getValue() == EP.True || (this.enderPearls.getValue() == EP.OnShift && FarThrow.mc.player.movementInput.sneak)) && item == Items.ENDER_PEARL;
			boolean pots = this.potions.getValue() && Arrays.asList(Items.LINGERING_POTION, Items.SPLASH_POTION, Items.EXPERIENCE_BOTTLE).contains(item);
			boolean eggzBallz = this.eggsAndSnowballs.getValue() && Arrays.asList(Items.EGG, Items.SNOWBALL).contains(item);
			if (eps || pots || eggzBallz) {
				FarThrow.mc.getConnection().sendPacket(new CPacketEntityAction(FarThrow.mc.player, CPacketEntityAction.Action.START_SPRINTING));
				for (int i = 0; i < this.spoof.getValue(); i++) {
					FarThrow.mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(FarThrow.mc.player.posX, FarThrow.mc.player.posY + 1e-10, FarThrow.mc.player.posZ, FarThrow.mc.player.rotationYaw, FarThrow.mc.player.rotationPitch, false));
					FarThrow.mc.getConnection().sendPacket(new CPacketPlayer.PositionRotation(FarThrow.mc.player.posX, FarThrow.mc.player.posY, FarThrow.mc.player.posZ, FarThrow.mc.player.rotationYaw, FarThrow.mc.player.rotationPitch, true));
				}
			}
		}
	}
	
	public enum EP {
		False,
		OnShift,
		True
    }
}